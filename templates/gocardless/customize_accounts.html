{% extends "base.html" %}

{% block content %}
<style>
    .divider {
        width: 70%;
        background-color: gray;
        height: 1px;
        margin-top: 2px;
        margin-bottom: 2px;
        opacity: .75;
    }
</style>
<div class="container">
    <h1 class="mb-4">Select your accounts for GoCardless</h1>

    <div class="tab-content" id="importTabsContent">
        <div class="tab-pane fade show active" id="choose-country" role="tabpanel">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Accounts</h5>
                </div>
                <div class="card-body">
                    <p>The following accounts were found with the newest requisition:</p>
                    <form id="accounts" method="POST" action="{{ url_for('gocardless.add_accounts') }}">
                    </form>
                    <p>Select the ones you want to import into Dollar Dollar Bill Y'all, and click the submit
                        button.
                    </p>
                    <div class="alert alert-info">
                        <i class="fas fa-shield-alt me-2"></i>
                        Each refresh of this page will make another request to the GoCardless servers to fetch account
                        details. You are limited to 4 requests per day per account.
                    </div>
                    <!-- Collapsible form section - hidden by default -->
                    <div id="accountFormSection">
                        <div class="card-body">
                            <form id="customizations" method="POST" action="{{ url_for('gocardless.add_accounts') }}"
                                class="g-3">
                                {% for account in accounts %}
                                <div class="card-body border rounded mb-2">
                                    <div class="mb-2" style="display: flex;">
                                        <div class="border-bottom me-2" style="width: fit-content;">{{ account }}</div>
                                        {% if account_details[account]['account']['name'] %}
                                        <div>{{ account_details[account]['account']['name'] }}</div>
                                        {% else %}
                                        <div>{{ account_details[account]['account']['ownerName'] }} | {{ account_details[account]['account']['iban'] }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="account_name_{{ account }}" class="form-label">Account
                                                Name</label>
                                            <input type="text" class="form-control bg-dark text-light"
                                                id="account_name_{{ account }}" name="name_{{ account }}" required
                                                placeholder="e.g., Chase Checking"
                                                value="{{ account_details[account]['name'] }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="account_type_{{ account }}" class="form-label">Account
                                                Type</label>
                                            <select class="form-select bg-dark text-light"
                                                id="account_type_{{ account }}" name="type_{{ account }}" required>
                                                <option value="checking">Checking</option>
                                                <option value="savings">Savings</option>
                                                <option value="credit">Credit Card</option>
                                                <option value="investment">Investment</option>
                                                <option value="loan">Loan</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="institution_{{ account }}" class="form-label">Financial
                                                Institution
                                                (Optional)</label>
                                            <input type="text" class="form-control bg-dark text-light"
                                                id="institution_{{ account }}" name="institution_{{ account }}"
                                                value="{{ institutions[account_details[account]['institution_id']]['name'] }}"
                                                readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="currency_code_{{ account }}" class="form-label">Currency</label>
                                            <select class="form-select bg-dark text-light"
                                                id="currency_code_{{ account }}" name="currency_code_{{ account }}">
                                                {% for currency in currencies %}
                                                <option value="{{ currency.code }}" {% if
                                                    currency.code==account_details[account]['currency'] %}selected{%
                                                    endif %}>
                                                    {{ currency.code }} ({{ currency.symbol }})
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-between">
        <a id="cancel-btn" href="{{ url_for('account.advanced') }}" class="btn btn-danger">
            <i class="fas fa-arrow-left me-1"></i>Cancel
        </a>
        <button type="submit" id="submit-btn" class="btn btn-primary" form="customizations">
            <i class="fas fa-checkmark me-1"></i>Submit
        </button>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
{% endblock %}